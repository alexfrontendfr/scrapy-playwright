{% extends "base.html" %} {% block content %}
<h1 class="text-4xl mb-5 text-center">Web Scraper - Terminal Matrix UI</h1>

<form id="searchForm" class="mb-8">
  <div class="mb-4">
    <label for="query" class="block mb-2">Enter Search Term:</label>
    <input
      type="text"
      id="query"
      name="query"
      required
      class="w-full p-2 bg-black border border-green-500 text-green-500"
    />
  </div>

  <div class="mb-4">
    <label for="engine" class="block mb-2">Select Search Engine:</label>
    <select
      id="engine"
      name="engine"
      required
      class="w-full p-2 bg-black border border-green-500 text-green-500"
    >
      <option value="google">Google</option>
      <option value="bing">Bing</option>
      <option value="duckduckgo">DuckDuckGo</option>
      <option value="onion">Onion</option>
      <option value="keyword">Keyword</option>
    </select>
  </div>

  <div class="mb-4">
    <label for="limit" class="block mb-2">Result Limit:</label>
    <input
      type="number"
      id="limit"
      name="limit"
      min="1"
      max="100"
      value="10"
      required
      class="w-full p-2 bg-black border border-green-500 text-green-500"
    />
  </div>

  <div class="mb-4">
    <label class="flex items-center">
      <input type="checkbox" id="use_tor" name="use_tor" class="mr-2" />
      <span>Use Tor (for anonymous scraping)</span>
    </label>
  </div>

  <button
    type="submit"
    class="w-full p-2 bg-green-500 text-black font-bold hover:bg-green-600"
  >
    Start Search
  </button>
</form>

<div id="statusContainer" class="mt-8 hidden">
  <h2 class="text-2xl mb-4">Scraping Status</h2>
  <div class="bg-gray-200 rounded">
    <div
      id="progressBar"
      class="bg-green-500 text-xs leading-none py-1 text-center text-white rounded"
      style="width: 0%"
    ></div>
  </div>
  <p id="statusText" class="mt-2"></p>
</div>

<div id="resultsContainer" class="mt-8 hidden">
  <h2 class="text-2xl mb-4">Search Results</h2>
  <ul id="resultsList" class="list-disc pl-5"></ul>
</div>

<script>
  document
    .getElementById("searchForm")
    .addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const statusContainer = document.getElementById("statusContainer");
      const progressBar = document.getElementById("progressBar");
      const statusText = document.getElementById("statusText");
      const resultsContainer = document.getElementById("resultsContainer");
      const resultsList = document.getElementById("resultsList");

      statusContainer.classList.remove("hidden");
      resultsContainer.classList.add("hidden");
      resultsList.innerHTML = "";

      fetch("/search", {
        method: "POST",
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.status === "success") {
            checkStatus();
          }
        });
    });

  function checkStatus() {
    fetch("/status")
      .then((response) => response.json())
      .then((data) => {
        const progressBar = document.getElementById("progressBar");
        const statusText = document.getElementById("statusText");

        progressBar.style.width = `${data.progress}%`;
        statusText.textContent = data.is_scraping
          ? "Scraping in progress..."
          : "Scraping complete";

        if (data.is_scraping) {
          setTimeout(checkStatus, 1000);
        } else {
          fetchResults();
        }
      });
  }

  function fetchResults() {
    fetch("/results")
      .then((response) => response.text())
      .then((html) => {
        const resultsContainer = document.getElementById("resultsContainer");
        const resultsList = document.getElementById("resultsList");

        resultsContainer.classList.remove("hidden");
        resultsList.innerHTML = html;
      });
  }
</script>
{% endblock %}
